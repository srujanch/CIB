#
#View types:
# Home = homepage
# Product Selector = productselectorpage
# Recent Deals = recentdealspage
# Custom = custom
#

#
# ACCOLADES SQL
#

# homepage accolades
dam.sql.accolades.homepage=SELECT * FROM (SELECT ACCOLADE_ID AS ACCOLADE_ID,VGN_DAM.DAM_ACCOLADES.DESCRIPTION AS ACCOLADE_DESCRIPTION, VGN_DAM.DAM_PUBLICATIONS.DESCRIPTION AS PUBLICATION_NAME,YEAR AS ACCOLADE_YEAR, row_number() over (ORDER BY Publish_To_Home DESC , ACCOLADE_ID DESC) rn FROM VGN_DAM.DAM_ACCOLADES  , VGN_DAM.DAM_PUBLICATIONS WHERE VGN_DAM.DAM_PUBLICATIONS.ID = VGN_DAM.DAM_ACCOLADES.PUBLICATION AND ACCOLADE_ID IN (SELECT ACCOLADE_ID FROM VGN_DAM.DAM_ACCOLADES WHERE ACCOLADE_ID IN   (SELECT ACCOLADE_ID FROM VGN_DAM.DAM_ACCOLADES WHERE   (ACCOLADE_ID IN    (SELECT VGN_DAM.DAM_ACCOLADES.ACCOLADE_ID FROM VGN_DAM.DAM_ACCOLADES WHERE (VGN_DAM.DAM_ACCOLADES.Status = 'ACTIVE') AND (VGN_DAM.DAM_ACCOLADES.PUBLISH_STATUS = 'Published')     AND (VGN_DAM.DAM_ACCOLADES.Publish_To_Home = 'Always' OR  VGN_DAM.DAM_ACCOLADES.Publish_To_Home = 'Yes')   )    )   AND    (ACCOLADE_ID IN   (SELECT VGN_DAM.DAM_COUNTRY_BINDING.DAM_ID FROM VGN_DAM.DAM_COUNTRY_BINDING    INNER JOIN VGN_DAM.DAM_COUNTRIES ON VGN_DAM.DAM_COUNTRY_BINDING.COUNTRY_ID = VGN_DAM.DAM_COUNTRIES.ID     WHERE (VGN_DAM.DAM_COUNTRY_BINDING.DAM_TYPE = 2)    AND (VGN_DAM.DAM_COUNTRIES.DESCRIPTION LIKE 'All - group websites')  )   AND     (ACCOLADE_ID IN   (SELECT VGN_DAM.DAM_SEGMENT_BINDING.DAM_ID FROM VGN_DAM.DAM_SEGMENTS    INNER JOIN VGN_DAM.DAM_SEGMENT_BINDING ON VGN_DAM.DAM_SEGMENTS.ID = VGN_DAM.DAM_SEGMENT_BINDING.SEGMENT_ID    WHERE (VGN_DAM.DAM_SEGMENT_BINDING.DAM_TYPE = 2)    AND (VGN_DAM.DAM_SEGMENTS.VALUE = 'Corporate and Investment Banking')    )  )    )    ))) where rn <= ?PARAM-NUMBER-MAXROWS?

# accoladeslandingpage - main accolades page, with pagination (supported here by BETWEEN in rownumber filter)
dam.sql.accolades.accoladeslandingpage=SELECT * FROM (SELECT ACCOLADE_ID ,VGN_DAM.DAM_ACCOLADES.DESCRIPTION AS ACCOLADE_DESCRIPTION, YEAR AS ACCOLADE_YEAR, VGN_DAM.DAM_PUBLICATIONS.VALUE AS PUBLICATION_NAME, row_number() over (ORDER BY VGN_DAM.DAM_PUBLICATIONS.VALUE ASC, nlssort(VGN_DAM.DAM_ACCOLADES.DESCRIPTION,'NLS_SORT=BINARY_CI') ASC, Year DESC) rn FROM VGN_DAM.DAM_ACCOLADES INNER JOIN VGN_DAM.DAM_PUBLICATIONS ON VGN_DAM.DAM_ACCOLADES.PUBLICATION = VGN_DAM.DAM_PUBLICATIONS.ID WHERE (ACCOLADE_ID IN (SELECT VGN_DAM.DAM_COUNTRY_BINDING.DAM_ID FROM VGN_DAM.DAM_COUNTRIES INNER JOIN VGN_DAM.DAM_COUNTRY_BINDING ON VGN_DAM.DAM_COUNTRIES.ID = VGN_DAM.DAM_COUNTRY_BINDING.COUNTRY_ID WHERE (VGN_DAM.DAM_COUNTRIES.DESCRIPTION = 'All - group websites') AND (VGN_DAM.DAM_COUNTRY_BINDING.DAM_TYPE = 2)))  AND (ACCOLADE_ID IN (SELECT VGN_DAM.DAM_SEGMENT_BINDING.DAM_ID FROM VGN_DAM.DAM_SEGMENTS INNER JOIN VGN_DAM.DAM_SEGMENT_BINDING ON VGN_DAM.DAM_SEGMENTS.ID = VGN_DAM.DAM_SEGMENT_BINDING.SEGMENT_ID WHERE (VGN_DAM.DAM_SEGMENT_BINDING.DAM_TYPE = 2) AND (VGN_DAM.DAM_SEGMENTS.VALUE = 'Corporate and Investment Banking') )) AND (ACCOLADE_ID IN (SELECT VGN_DAM.DAM_ACCOLADES.ACCOLADE_ID FROM VGN_DAM.DAM_ACCOLADES WHERE (VGN_DAM.DAM_ACCOLADES.Status = 'ACTIVE') AND (VGN_DAM.DAM_ACCOLADES.PUBLISH_STATUS = 'Published') AND VGN_DAM.DAM_ACCOLADES.Year >= ?PARAM-STRING-YEAR?))) WHERE rn BETWEEN ?PARAM-NUMBER-FIRSTROW? AND ?PARAM-NUMBER-LASTROW?

# recentaccoladespage - this is used for recent accolades filtered for product or sector (NB - YEAR FILTER INCOMPLETE)
dam.sql.accolades.recentaccoladespage=SELECT * FROM (SELECT ACCOLADE_ID ,VGN_DAM.DAM_ACCOLADES.DESCRIPTION AS ACCOLADE_DESCRIPTION, YEAR AS ACCOLADE_YEAR, VGN_DAM.DAM_PUBLICATIONS.VALUE AS PUBLICATION_NAME, row_number() OVER (ORDER BY DAM_PUBLICATIONS.VALUE ASC, Year DESC, DAM_ACCOLADES.DESCRIPTION ASC, ACCOLADE_ID DESC) rn FROM VGN_DAM.DAM_ACCOLADES INNER JOIN VGN_DAM.DAM_PUBLICATIONS ON VGN_DAM.DAM_ACCOLADES.Publication = VGN_DAM.DAM_PUBLICATIONS.ID WHERE (ACCOLADE_ID IN (SELECT VGN_DAM.DAM_ACCOLADES.ACCOLADE_ID FROM VGN_DAM.DAM_ACCOLADES  INNER JOIN VGN_DAM.DAM_SECTORS ON VGN_DAM.DAM_ACCOLADES.SECTOR = VGN_DAM.DAM_SECTORS.ID WHERE  (VGN_DAM.DAM_SECTORS.VALUE LIKE '%') AND (VGN_DAM.DAM_ACCOLADES.Year LIKE 2011) AND (VGN_DAM.DAM_ACCOLADES.Status = 'ACTIVE') AND (VGN_DAM.DAM_ACCOLADES.PUBLISH_STATUS = 'Published')))  AND (ACCOLADE_ID IN (SELECT VGN_DAM.DAM_PRODUCT_BINDING.DAM_ID FROM VGN_DAM.DAM_PRODUCT_BINDING  INNER JOIN VGN_DAM.DAM_PRODUCTS ON VGN_DAM.DAM_PRODUCT_BINDING.PRODUCT_ID = VGN_DAM.DAM_PRODUCTS.ID WHERE (VGN_DAM.DAM_PRODUCT_BINDING.DAM_TYPE = 2)  AND VGN_DAM.DAM_PRODUCTS.VALUE LIKE '%'))   AND (ACCOLADE_ID IN  (SELECT VGN_DAM.DAM_COUNTRY_BINDING.DAM_ID FROM VGN_DAM.DAM_COUNTRY_BINDING INNER JOIN VGN_DAM.DAM_COUNTRIES  ON VGN_DAM.DAM_COUNTRY_BINDING.COUNTRY_ID = VGN_DAM.DAM_COUNTRIES.ID  WHERE (VGN_DAM.DAM_COUNTRY_BINDING.DAM_TYPE = 2)  AND VGN_DAM.DAM_COUNTRIES.DESCRIPTION = 'All - group websites'))   AND (ACCOLADE_ID IN (SELECT VGN_DAM.DAM_SEGMENT_BINDING.DAM_ID FROM VGN_DAM.DAM_SEGMENTS  INNER JOIN VGN_DAM.DAM_SEGMENT_BINDING ON VGN_DAM.DAM_SEGMENTS.ID = VGN_DAM.DAM_SEGMENT_BINDING.SEGMENT_ID  WHERE (VGN_DAM.DAM_SEGMENT_BINDING.DAM_TYPE = 2)  AND (VGN_DAM.DAM_SEGMENTS.VALUE = 'Corporate and Investment Banking') )))   WHERE rn <= ?PARAM-NUMBER-MAXROWS?

# productselectorpage - product, country or sector, also with year filter
dam.sql.accolades.productselectorpage=SELECT ACCOLADE_ID AS ACCOLADE_ID,VGN_DAM.DAM_ACCOLADES.DESCRIPTION AS ACCOLADE_DESCRIPTION, YEAR AS ACCOLADE_YEAR FROM VGN_DAM.DAM_ACCOLADES WHERE (ACCOLADE_ID IN (SELECT ACCOLADE_ID FROM VGN_DAM.DAM_ACCOLADES INNER JOIN VGN_DAM.DAM_SECTORS ON VGN_DAM.DAM_ACCOLADES.Sector = VGN_DAM.DAM_SECTORS.ID  WHERE  (VGN_DAM.DAM_SECTORS.VALUE LIKE ?PARAM-STRING-SECTOR?) AND (VGN_DAM.DAM_ACCOLADES.YEAR LIKE ?PARAM-STRING-YEAR?)  AND (VGN_DAM.DAM_ACCOLADES.STATUS = 'ACTIVE') AND (VGN_DAM.DAM_ACCOLADES.PUBLISH_STATUS = 'Published')))  AND (ACCOLADE_ID IN (SELECT VGN_DAM.DAM_PRODUCT_BINDING.DAM_ID FROM VGN_DAM.DAM_PRODUCT_BINDING INNER JOIN VGN_DAM.DAM_PRODUCTS ON VGN_DAM.DAM_PRODUCT_BINDING.PRODUCT_ID = VGN_DAM.DAM_PRODUCTS.ID WHERE (VGN_DAM.DAM_PRODUCT_BINDING.DAM_TYPE = 2) AND (VGN_DAM.DAM_PRODUCTS.VALUE LIKE 'All%' OR VGN_DAM.DAM_PRODUCTS.VALUE LIKE ?PARAM-STRING-PRODUCT?)))  AND (ACCOLADE_ID IN (SELECT VGN_DAM.DAM_COUNTRY_BINDING.DAM_ID FROM VGN_DAM.DAM_COUNTRY_BINDING INNER JOIN VGN_DAM.DAM_COUNTRIES ON VGN_DAM.DAM_COUNTRY_BINDING.COUNTRY_ID = VGN_DAM.DAM_COUNTRIES.ID WHERE (VGN_DAM.DAM_COUNTRY_BINDING.DAM_TYPE = 2) AND (VGN_DAM.DAM_COUNTRIES.DESCRIPTION LIKE ?PARAM-STRING-COUNTRY? OR VGN_DAM.DAM_COUNTRIES.DESCRIPTION = 'All - country CIB websites'))) AND (ACCOLADE_ID IN (SELECT VGN_DAM.DAM_SEGMENT_BINDING.DAM_ID FROM VGN_DAM.DAM_SEGMENTS INNER JOIN VGN_DAM.DAM_SEGMENT_BINDING ON VGN_DAM.DAM_SEGMENTS.ID = VGN_DAM.DAM_SEGMENT_BINDING.SEGMENT_ID WHERE (VGN_DAM.DAM_SEGMENT_BINDING.DAM_TYPE = 2) AND (VGN_DAM.DAM_SEGMENTS.VALUE = 'Corporate and Investment Banking') )) ORDER BY YEAR DESC, ACCOLADE_ID DESC



#
# DEALS SQL
# NB: Return both full date and year only. Full year is sort field, display is year only.
# Return length of full description, to be used for deciding whether or not to show link to deal detail page.
#

# homepage deals
dam.sql.deals.homepage=SELECT rn, DEAL_ID, DEAL_ANNOUNCED, to_char(DEAL_ANNOUNCED,'YYYY') AS DEAL_ANNOUNCED_YEAR, DEAL_TITLE, DEAL_SHORT_DESCRIPTION, DEAL_DESCRIPTION_LENGTH, LISTAGG(COUNTRY, ', ') WITHIN GROUP (ORDER BY DEAL_ANNOUNCED DESC, DEAL_TITLE, COUNTRY) "DEAL_COUNTRIES" FROM (SELECT VGN_DAM.DAM_DEALS.DEAL_ID AS DEAL_ID,  VGN_DAM.DAM_DEALS.ANNOUNCED AS DEAL_ANNOUNCED, VGN_DAM.DAM_DEALS.TITLE AS DEAL_TITLE, VGN_DAM.DAM_DEALS.SHORT_DESCRIPTION AS DEAL_SHORT_DESCRIPTION, to_char(VGN_DAM.DAM_COUNTRIES.DESCRIPTION) AS COUNTRY, length(VGN_DAM.DAM_DEALS.DESCRIPTION) as DEAL_DESCRIPTION_LENGTH, row_number() OVER (ORDER BY VGN_DAM.DAM_DEALS.ANNOUNCED DESC, VGN_DAM.DAM_DEALS.DEAL_ID DESC) rn  FROM VGN_DAM.DAM_DEALS, VGN_DAM.DAM_COUNTRY_BINDING, VGN_DAM.DAM_COUNTRIES WHERE VGN_DAM.DAM_DEALS.DEAL_ID=VGN_DAM.DAM_COUNTRY_BINDING.DAM_ID  AND VGN_DAM.DAM_COUNTRY_BINDING.DAM_TYPE = 1 AND VGN_DAM.DAM_COUNTRY_BINDING.COUNTRY_ID=VGN_DAM.DAM_COUNTRIES.ID AND (VGN_DAM.DAM_DEALS.STATUS = 'ACTIVE') AND (VGN_DAM.DAM_DEALS.PUBLISH_STATUS = 'Published')  AND (VGN_DAM.DAM_DEALS.PUBLISH_TO_HOME = 'Yes' OR VGN_DAM.DAM_DEALS.PUBLISH_TO_HOME = 'Override')  AND (DEAL_ID IN  ( SELECT VGN_DAM.DAM_SEGMENT_BINDING.DAM_ID  FROM VGN_DAM.DAM_SEGMENT_BINDING  INNER JOIN VGN_DAM.DAM_SEGMENTS ON VGN_DAM.DAM_SEGMENT_BINDING.SEGMENT_ID = VGN_DAM.DAM_SEGMENTS.ID  WHERE (VGN_DAM.DAM_SEGMENTS.VALUE LIKE 'Corporate and Investment Banking' AND DAM_TYPE = 1))) ) WHERE rn <= ?PARAM-NUMBER-MAXROWS? GROUP BY DEAL_ID, DEAL_ANNOUNCED, DEAL_TITLE, DEAL_SHORT_DESCRIPTION, DEAL_DESCRIPTION_LENGTH, rn ORDER BY rn ASC 

# deals landing page
# OLD - ORDERING IS INCORRECT dam.sql.deals.dealslandingpage=SELECT rn, DEAL_ID, DEAL_ANNOUNCED, to_char(DEAL_ANNOUNCED,'YYYY') AS DEAL_ANNOUNCED_YEAR, DEAL_TITLE, DEAL_SHORT_DESCRIPTION, LISTAGG(COUNTRY, ', ') WITHIN GROUP (ORDER BY DEAL_ANNOUNCED DESC, DEAL_TITLE, COUNTRY) "DEAL_COUNTRIES" FROM (SELECT  VGN_DAM.DAM_DEALS.DEAL_ID AS  DEAL_ID, VGN_DAM.DAM_DEALS.ANNOUNCED AS DEAL_ANNOUNCED, VGN_DAM.DAM_DEALS.TITLE AS DEAL_TITLE, VGN_DAM.DAM_DEALS.SHORT_DESCRIPTION AS DEAL_SHORT_DESCRIPTION, to_char(VGN_DAM.DAM_COUNTRIES.DESCRIPTION) AS COUNTRY, row_number() OVER (ORDER BY VGN_DAM.DAM_DEALS.ANNOUNCED DESC, VGN_DAM.DAM_DEALS.TITLE) as rn FROM VGN_DAM.DAM_DEALS, VGN_DAM.DAM_COUNTRY_BINDING, VGN_DAM.DAM_COUNTRIES WHERE VGN_DAM.DAM_DEALS.DEAL_ID=VGN_DAM.DAM_COUNTRY_BINDING.DAM_ID  AND VGN_DAM.DAM_COUNTRY_BINDING.DAM_TYPE = 1 AND VGN_DAM.DAM_COUNTRY_BINDING.COUNTRY_ID=VGN_DAM.DAM_COUNTRIES.ID AND (VGN_DAM.DAM_DEALS.STATUS = 'ACTIVE') AND (VGN_DAM.DAM_DEALS.PUBLISH_STATUS = 'Published')  AND (DEAL_ID IN ( SELECT VGN_DAM.DAM_SEGMENT_BINDING.DAM_ID FROM VGN_DAM.DAM_SEGMENT_BINDING INNER JOIN VGN_DAM.DAM_SEGMENTS ON VGN_DAM.DAM_SEGMENT_BINDING.SEGMENT_ID = VGN_DAM.DAM_SEGMENTS.ID  WHERE (VGN_DAM.DAM_SEGMENTS.VALUE LIKE 'Corporate and Investment Banking' and DAM_TYPE = 1)))) WHERE rn BETWEEN ?PARAM-NUMBER-FIRSTROW? AND ?PARAM-NUMBER-LASTROW? GROUP BY DEAL_ID, DEAL_ANNOUNCED, DEAL_TITLE, DEAL_SHORT_DESCRIPTION
# before adding products  dam.sql.deals.dealslandingpage=SELECT rn, DEAL_ID, DEAL_ANNOUNCED, to_char(DEAL_ANNOUNCED,'YYYY') AS DEAL_ANNOUNCED_YEAR, DEAL_TITLE, DEAL_SHORT_DESCRIPTION, LISTAGG(COUNTRY, ', ') WITHIN GROUP (ORDER BY rn ASC) AS DEAL_COUNTRIES FROM (SELECT  VGN_DAM.DAM_DEALS.DEAL_ID AS  DEAL_ID, VGN_DAM.DAM_DEALS.ANNOUNCED AS DEAL_ANNOUNCED, VGN_DAM.DAM_DEALS.TITLE AS DEAL_TITLE, VGN_DAM.DAM_DEALS.SHORT_DESCRIPTION AS DEAL_SHORT_DESCRIPTION, to_char(VGN_DAM.DAM_COUNTRIES.DESCRIPTION) AS COUNTRY, row_number() OVER (ORDER BY VGN_DAM.DAM_DEALS.ANNOUNCED DESC, VGN_DAM.DAM_DEALS.DEAL_ID DESC, VGN_DAM.DAM_DEALS.TITLE) as rn FROM VGN_DAM.DAM_DEALS, VGN_DAM.DAM_COUNTRY_BINDING, VGN_DAM.DAM_COUNTRIES WHERE VGN_DAM.DAM_DEALS.DEAL_ID=VGN_DAM.DAM_COUNTRY_BINDING.DAM_ID  AND VGN_DAM.DAM_COUNTRY_BINDING.DAM_TYPE = 1 AND VGN_DAM.DAM_COUNTRY_BINDING.COUNTRY_ID=VGN_DAM.DAM_COUNTRIES.ID AND (VGN_DAM.DAM_DEALS.STATUS = 'ACTIVE') AND (VGN_DAM.DAM_DEALS.PUBLISH_STATUS = 'Published')  AND (DEAL_ID IN ( SELECT VGN_DAM.DAM_SEGMENT_BINDING.DAM_ID FROM VGN_DAM.DAM_SEGMENT_BINDING INNER JOIN VGN_DAM.DAM_SEGMENTS ON VGN_DAM.DAM_SEGMENT_BINDING.SEGMENT_ID = VGN_DAM.DAM_SEGMENTS.ID  WHERE (VGN_DAM.DAM_SEGMENTS.VALUE LIKE 'Corporate and Investment Banking' and DAM_TYPE = 1)))) WHERE rn BETWEEN ?PARAM-NUMBER-FIRSTROW? AND ?PARAM-NUMBER-LASTROW? GROUP BY rn, DEAL_ID, DEAL_ANNOUNCED, DEAL_TITLE, DEAL_SHORT_DESCRIPTION ORDER BY rn ASC
dam.sql.deals.dealslandingpage=SELECT rn, DEAL_ID, DEAL_ANNOUNCED, to_char(DEAL_ANNOUNCED,'YYYY') AS DEAL_ANNOUNCED_YEAR, DEAL_TITLE, DEAL_SHORT_DESCRIPTION, DEAL_DESCRIPTION_LENGTH, LISTAGG(COUNTRY, ', ') WITHIN GROUP (ORDER BY rn ASC) AS DEAL_COUNTRIES ,LISTAGG(PRODUCT, ', ') WITHIN GROUP (ORDER BY rn ASC) AS DEAL_PRODUCTS FROM (SELECT  VGN_DAM.DAM_DEALS.DEAL_ID AS  DEAL_ID, VGN_DAM.DAM_DEALS.ANNOUNCED AS DEAL_ANNOUNCED, VGN_DAM.DAM_DEALS.TITLE AS DEAL_TITLE, VGN_DAM.DAM_DEALS.SHORT_DESCRIPTION AS DEAL_SHORT_DESCRIPTION, to_char(VGN_DAM.DAM_COUNTRIES.DESCRIPTION) AS COUNTRY, to_char(VGN_DAM.DAM_PRODUCTS.DESCRIPTION) AS PRODUCT, length(VGN_DAM.DAM_DEALS.DESCRIPTION) as DEAL_DESCRIPTION_LENGTH, row_number() OVER (ORDER BY VGN_DAM.DAM_DEALS.ANNOUNCED DESC, VGN_DAM.DAM_DEALS.DEAL_ID DESC, VGN_DAM.DAM_DEALS.TITLE) as rn FROM VGN_DAM.DAM_DEALS, VGN_DAM.DAM_COUNTRY_BINDING, VGN_DAM.DAM_COUNTRIES, VGN_DAM.DAM_PRODUCT_BINDING, VGN_DAM.DAM_PRODUCTS WHERE VGN_DAM.DAM_DEALS.DEAL_ID=VGN_DAM.DAM_COUNTRY_BINDING.DAM_ID  AND VGN_DAM.DAM_COUNTRY_BINDING.DAM_TYPE = 1 AND VGN_DAM.DAM_COUNTRY_BINDING.COUNTRY_ID=VGN_DAM.DAM_COUNTRIES.ID AND VGN_DAM.DAM_DEALS.DEAL_ID=VGN_DAM.DAM_PRODUCT_BINDING.DAM_ID  AND VGN_DAM.DAM_PRODUCT_BINDING.DAM_TYPE = 1 AND VGN_DAM.DAM_PRODUCT_BINDING.PRODUCT_ID=VGN_DAM.DAM_PRODUCTS.ID AND (VGN_DAM.DAM_DEALS.STATUS = 'ACTIVE') AND (VGN_DAM.DAM_DEALS.PUBLISH_STATUS = 'Published')  AND (DEAL_ID IN ( SELECT VGN_DAM.DAM_SEGMENT_BINDING.DAM_ID FROM VGN_DAM.DAM_SEGMENT_BINDING INNER JOIN VGN_DAM.DAM_SEGMENTS ON VGN_DAM.DAM_SEGMENT_BINDING.SEGMENT_ID = VGN_DAM.DAM_SEGMENTS.ID  WHERE (VGN_DAM.DAM_SEGMENTS.VALUE LIKE 'Corporate and Investment Banking' and DAM_TYPE = 1)))) WHERE rn BETWEEN ?PARAM-NUMBER-FIRSTROW? AND ?PARAM-NUMBER-LASTROW?  GROUP BY rn, DEAL_ID, DEAL_ANNOUNCED, DEAL_TITLE, DEAL_SHORT_DESCRIPTION, DEAL_DESCRIPTION_LENGTH ORDER BY rn ASC


# recent deals - 
dam.sql.deals.recentdealspage=SELECT rn, DEAL_ID, DEAL_ANNOUNCED, to_char(DEAL_ANNOUNCED,'YYYY') AS DEAL_ANNOUNCED_YEAR, DEAL_TITLE, DEAL_DESCRIPTION_LENGTH, LISTAGG(COUNTRY, ', ') WITHIN GROUP (ORDER BY DEAL_ANNOUNCED DESC, DEAL_TITLE, COUNTRY) "DEAL_COUNTRIES" FROM (SELECT  VGN_DAM.DAM_DEALS.DEAL_ID AS  DEAL_ID, VGN_DAM.DAM_DEALS.ANNOUNCED AS DEAL_ANNOUNCED, VGN_DAM.DAM_DEALS.TITLE AS DEAL_TITLE, VGN_DAM.DAM_DEALS.SHORT_DESCRIPTION AS DEAL_SHORT_DESC, to_char(VGN_DAM.DAM_COUNTRIES.DESCRIPTION) AS COUNTRY, length(VGN_DAM.DAM_DEALS.DESCRIPTION) as DEAL_DESCRIPTION_LENGTH,row_number() OVER (ORDER BY VGN_DAM.DAM_DEALS.ANNOUNCED DESC, VGN_DAM.DAM_DEALS.TITLE) as rn FROM VGN_DAM.DAM_DEALS, VGN_DAM.DAM_COUNTRY_BINDING, VGN_DAM.DAM_COUNTRIES WHERE VGN_DAM.DAM_DEALS.DEAL_ID=VGN_DAM.DAM_COUNTRY_BINDING.DAM_ID  AND VGN_DAM.DAM_COUNTRY_BINDING.DAM_TYPE = 1 AND VGN_DAM.DAM_COUNTRY_BINDING.COUNTRY_ID=VGN_DAM.DAM_COUNTRIES.ID AND (VGN_DAM.DAM_DEALS.STATUS = 'ACTIVE') AND (VGN_DAM.DAM_DEALS.PUBLISH_STATUS = 'Published')  AND (DEAL_ID IN ( SELECT VGN_DAM.DAM_SEGMENT_BINDING.DAM_ID FROM VGN_DAM.DAM_SEGMENT_BINDING INNER JOIN VGN_DAM.DAM_SEGMENTS ON VGN_DAM.DAM_SEGMENT_BINDING.SEGMENT_ID = VGN_DAM.DAM_SEGMENTS.ID  WHERE (VGN_DAM.DAM_SEGMENTS.VALUE LIKE 'Corporate and Investment Banking' and DAM_TYPE = 1)))) WHERE rn <= ?PARAM-NUMBER-MAXROWS? GROUP BY rn, DEAL_ID, DEAL_ANNOUNCED, DEAL_TITLE, DEAL_DESCRIPTION_LENGTH ORDER BY rn ASC


#single deal - has deal id parameter placeholder set to ?, not using substitution as on main queries
# was not returning products dam.sql.deals.dealdetailspage=SELECT DEAL_ID, DEAL_ANNOUNCED, to_char(DEAL_ANNOUNCED,'YYYY') AS DEAL_ANNOUNCED_YEAR, DEAL_TITLE, DEAL_DESCRIPTION, LISTAGG(COUNTRY, ', ') WITHIN GROUP (ORDER BY COUNTRY) "DEAL_COUNTRIES" FROM (SELECT  VGN_DAM.DAM_DEALS.DEAL_ID AS  DEAL_ID, VGN_DAM.DAM_DEALS.ANNOUNCED AS DEAL_ANNOUNCED, VGN_DAM.DAM_DEALS.TITLE AS DEAL_TITLE, VGN_DAM.DAM_DEALS.SHORT_DESCRIPTION AS DEAL_SHORT_DESC, to_char(VGN_DAM.DAM_COUNTRIES.DESCRIPTION) AS COUNTRY, to_char(VGN_DAM.DAM_DEALS.DESCRIPTION) as DEAL_DESCRIPTION FROM VGN_DAM.DAM_DEALS, VGN_DAM.DAM_COUNTRY_BINDING, VGN_DAM.DAM_COUNTRIES WHERE VGN_DAM.DAM_DEALS.DEAL_ID=VGN_DAM.DAM_COUNTRY_BINDING.DAM_ID  AND VGN_DAM.DAM_COUNTRY_BINDING.DAM_TYPE = 1 AND VGN_DAM.DAM_COUNTRY_BINDING.COUNTRY_ID=VGN_DAM.DAM_COUNTRIES.ID AND (DEAL_ID = ?)) GROUP BY DEAL_ID, DEAL_ANNOUNCED, DEAL_TITLE, DEAL_DESCRIPTION 
dam.sql.deals.dealdetailspage=SELECT DEAL_ID, DEAL_ANNOUNCED, to_char(DEAL_ANNOUNCED,'YYYY') AS DEAL_ANNOUNCED_YEAR, DEAL_TITLE, DEAL_DESCRIPTION, LISTAGG(COUNTRY, ', ') WITHIN GROUP (ORDER BY COUNTRY) "DEAL_COUNTRIES", LISTAGG(PRODUCT, ', ') WITHIN GROUP (ORDER BY PRODUCT) "DEAL_PRODUCTS" FROM (SELECT  VGN_DAM.DAM_DEALS.DEAL_ID AS  DEAL_ID, VGN_DAM.DAM_DEALS.ANNOUNCED AS DEAL_ANNOUNCED, VGN_DAM.DAM_DEALS.TITLE AS DEAL_TITLE, VGN_DAM.DAM_DEALS.SHORT_DESCRIPTION AS DEAL_SHORT_DESC, to_char(VGN_DAM.DAM_COUNTRIES.DESCRIPTION) AS COUNTRY, to_char(VGN_DAM.DAM_PRODUCTS.DESCRIPTION) AS PRODUCT, to_char(VGN_DAM.DAM_DEALS.DESCRIPTION) as DEAL_DESCRIPTION FROM VGN_DAM.DAM_DEALS, VGN_DAM.DAM_COUNTRY_BINDING, VGN_DAM.DAM_COUNTRIES, VGN_DAM.DAM_PRODUCT_BINDING, VGN_DAM.DAM_PRODUCTS WHERE VGN_DAM.DAM_DEALS.DEAL_ID=VGN_DAM.DAM_COUNTRY_BINDING.DAM_ID  AND VGN_DAM.DAM_COUNTRY_BINDING.DAM_TYPE = 1 AND VGN_DAM.DAM_COUNTRY_BINDING.COUNTRY_ID=VGN_DAM.DAM_COUNTRIES.ID AND VGN_DAM.DAM_DEALS.DEAL_ID=VGN_DAM.DAM_PRODUCT_BINDING.DAM_ID  AND VGN_DAM.DAM_PRODUCT_BINDING.DAM_TYPE = 1 AND VGN_DAM.DAM_PRODUCT_BINDING.PRODUCT_ID=VGN_DAM.DAM_PRODUCTS.ID AND (DEAL_ID = ?)) GROUP BY DEAL_ID, DEAL_ANNOUNCED, DEAL_TITLE, DEAL_DESCRIPTION


# client, product, country or sector, (year filter still to be implemented!)
# built sql from scratch to try to simplify - still need to review and compare with original sql from SB
dam.sql.deals.productselectorpage=SELECT rn, DEAL_ID, DEAL_ANNOUNCED, to_char(DEAL_ANNOUNCED,'YYYY') AS DEAL_ANNOUNCED_YEAR, DEAL_TITLE, DEAL_SHORT_DESCRIPTION, DEAL_DESCRIPTION_LENGTH, LISTAGG(COUNTRY, ', ') WITHIN GROUP (ORDER BY rn ASC) AS DEAL_COUNTRIES ,LISTAGG(PRODUCT, ', ') WITHIN GROUP (ORDER BY rn ASC) AS DEAL_PRODUCTS FROM (SELECT DEAL_ID, ANNOUNCED AS DEAL_ANNOUNCED , TITLE AS DEAL_TITLE, SHORT_DESCRIPTION AS DEAL_SHORT_DESCRIPTION, to_char(VGN_DAM.DAM_COUNTRIES.DESCRIPTION) AS COUNTRY, to_char(VGN_DAM.DAM_PRODUCTS.DESCRIPTION) AS PRODUCT, length(VGN_DAM.DAM_DEALS.DESCRIPTION) as DEAL_DESCRIPTION_LENGTH, row_number() OVER (ORDER BY VGN_DAM.DAM_DEALS.ANNOUNCED DESC, VGN_DAM.DAM_DEALS.DEAL_ID DESC, VGN_DAM.DAM_DEALS.TITLE) as rn FROM VGN_DAM.DAM_DEALS, VGN_DAM.DAM_SECTORS, VGN_DAM.DAM_COUNTRY_BINDING, VGN_DAM.DAM_COUNTRIES, VGN_DAM.DAM_PRODUCT_BINDING, VGN_DAM.DAM_PRODUCTS, VGN_DAM.DAM_SEGMENT_BINDING, VGN_DAM.DAM_SEGMENTS WHERE VGN_DAM.DAM_DEALS.CLIENT LIKE ?PARAM-STRING-CLIENT? AND VGN_DAM.DAM_DEALS.STATUS = 'ACTIVE' AND VGN_DAM.DAM_DEALS.PUBLISH_STATUS = 'Published' AND VGN_DAM.DAM_DEALS.Sector = DAM_SECTORS.ID AND VGN_DAM.DAM_SECTORS.VALUE LIKE ?PARAM-STRING-SECTOR? AND DEAL_ID = VGN_DAM.DAM_COUNTRY_BINDING.DAM_ID AND VGN_DAM.DAM_COUNTRY_BINDING.COUNTRY_ID = VGN_DAM.DAM_COUNTRIES.ID AND VGN_DAM.DAM_COUNTRY_BINDING.DAM_TYPE = 1 AND VGN_DAM.DAM_COUNTRIES.DESCRIPTION LIKE ?PARAM-STRING-COUNTRY? AND DEAL_ID = VGN_DAM.DAM_PRODUCT_BINDING.DAM_ID AND VGN_DAM.DAM_PRODUCT_BINDING.PRODUCT_ID = VGN_DAM.DAM_PRODUCTS.ID  AND VGN_DAM.DAM_PRODUCT_BINDING.DAM_TYPE = 1 AND VGN_DAM.DAM_PRODUCTS.VALUE LIKE ?PARAM-STRING-PRODUCT? AND DEAL_ID = VGN_DAM.DAM_SEGMENT_BINDING.DAM_ID  AND VGN_DAM.DAM_SEGMENT_BINDING.SEGMENT_ID = VGN_DAM.DAM_SEGMENTS.ID AND VGN_DAM.DAM_SEGMENTS.VALUE LIKE 'Corporate and Investment Banking' and VGN_DAM.DAM_SEGMENT_BINDING.dam_type = 1) GROUP BY rn, DEAL_ID, DEAL_ANNOUNCED, DEAL_TITLE, DEAL_SHORT_DESCRIPTION, DEAL_DESCRIPTION_LENGTH ORDER BY DEAL_ANNOUNCED DESC 


#
# All xxx country values, to be stripped from country list for display
#
dam.sql.all.countries.count=3
dam.sql.all.countries.1=All - country CIB websites
dam.sql.all.countries.2=All - Africa CIB websites
dam.sql.all.countries.3=All - group websites
